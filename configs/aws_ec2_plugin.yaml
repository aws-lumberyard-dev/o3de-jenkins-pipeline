# Config for AWS EC2 plugin
jenkins:
  clouds:
  - amazonEC2:
      cloudName: ${/jenkins/config/aws-region}
      instanceCapStr: "300"
      noDelayProvisioning: true
      region: "us-west-2"
      sshKeysCredentialsId: "jenkins-build-node" 
      templates:
      - ami: "ami-01434f0c2b86402d2"
        amiType:
          unixData:
            sshPort: "22"
        associatePublicIp: false
        connectBySSHProcess: false
        connectionStrategy: PRIVATE_IP
        deleteRootOnTermination: false
        description: "UBUNTU18_BLD_1"
        ebsEncryptRootVolume: DEFAULT
        ebsOptimized: true
        hostKeyVerificationStrategy: ACCEPT_NEW
        iamInstanceProfile: ${/jenkins/config/instanceprofile}
        idleTerminationMinutes: "30"
        labelString: "linux"
        launchTimeoutStr: "300"
        maxTotalUses: 1
        metadataEndpointEnabled: true
        metadataHopsLimit: 1
        metadataTokensRequired: true
        minimumNumberOfInstances: 0
        minimumNumberOfSpareInstances: 0
        mode: EXCLUSIVE
        monitoring: false
        numExecutors: 1
        remoteAdmin: ${/jenkins/config/buildnode/username}
        remoteFS: "/home/lybuilder/ly"
        securityGroups: ${/jenkins/config/security-group}
        stopOnTerminate: false
        subnetId: ${/jenkins/config/subnet-id}
        t2Unlimited: false
        tags:
        - name: "Name"
          value: "UBUNTU18_BLD_1"
        tenancy: Default
        type: C48xlarge
        useEphemeralDevices: false
        userData: "#!/bin/bash\nsed -i /etc/hosts -e \"s/^127.0.0.1 localhost$/127.0.0.1\
          \ localhost $(hostname)/\" \necho 'export ENV_3RDPARTY_PATH=/home/lybuilder/ly/workspace/3rdParty'\
          \ >> /etc/profile.d/jenkins_config.sh\necho 'export TMPDIR=/tmp' >> /etc/profile.d/jenkins_config.sh\n\
          sudo systemctl start filebeat\n\nsudo dd if=/dev/zero of=/swapfile bs=1M\
          \ count=6144 &&\nsudo chmod 600 /swapfile &&\nsudo mkswap /swapfile &&\n\
          sudo swapon /swapfile"
        zone: "us-west-2a"
      - ami: "ami-0aa178f91b1058347" 
        amiType:
          unixData:
            sshPort: "22"
        associatePublicIp: false
        connectBySSHProcess: false
        connectionStrategy: PRIVATE_IP
        deleteRootOnTermination: false
        description: "Sync-Fork"
        ebsEncryptRootVolume: DEFAULT
        ebsOptimized: true
        hostKeyVerificationStrategy: ACCEPT_NEW
        iamInstanceProfile: ${/jenkins/config/instanceprofile}
        idleTerminationMinutes: "30"
        labelString: "sync-fork"
        launchTimeoutStr: "300"
        maxTotalUses: 1
        metadataEndpointEnabled: true
        metadataHopsLimit: 1
        metadataTokensRequired: true
        minimumNumberOfInstances: 0
        minimumNumberOfSpareInstances: 0
        mode: EXCLUSIVE
        monitoring: false
        numExecutors: 1
        remoteAdmin: "ubuntu"
        remoteFS: "/home/ubuntu/workspace"
        securityGroups: "sg-010fd8d9324508982"
        stopOnTerminate: false
        subnetId: "subnet-095d78fbeba94a487"
        t2Unlimited: false
        tags:
        - name: "Name"
          value: "Sync-Fork"
        tenancy: Default
        type: M5Large
        useEphemeralDevices: false
        zone: "us-west-2b"
      - ami: "ami-03c90df95dd5c7349"
        amiType:
          unixData:
            sshPort: "22"
        associatePublicIp: false
        connectBySSHProcess: false
        connectionStrategy: PRIVATE_IP
        deleteRootOnTermination: false
        description: "Validation"
        ebsEncryptRootVolume: DEFAULT
        ebsOptimized: true
        hostKeyVerificationStrategy: ACCEPT_NEW
        iamInstanceProfile: ${/jenkins/config/instanceprofile}
        idleTerminationMinutes: "30"
        instanceCapStr: "1"
        labelString: "validation"
        launchTimeoutStr: "300"
        maxTotalUses: -1
        metadataEndpointEnabled: true
        metadataHopsLimit: 1
        metadataTokensRequired: true
        minimumNumberOfInstances: 0
        minimumNumberOfSpareInstances: 0
        mode: EXCLUSIVE
        monitoring: false
        numExecutors: 1
        remoteAdmin: "ubuntu"
        remoteFS: "/home/ubuntu/workspace"
        securityGroups: "sg-010fd8d9324508982"
        stopOnTerminate: true
        subnetId: "subnet-095d78fbeba94a487"
        t2Unlimited: false
        tags:
        - name: "Name"
          value: "Validation"
        tenancy: Default
        type: M5Large
        useEphemeralDevices: false
        zone: "us-west-2b"
      - ami: "ami-0b6a8649a4a28adb2"
        amiType:
          unixData:
            sshPort: "22"
        associatePublicIp: false
        connectBySSHProcess: false
        connectionStrategy: PRIVATE_IP
        deleteRootOnTermination: false
        description: "WIN2019_INC_3"
        ebsEncryptRootVolume: DEFAULT
        ebsOptimized: true
        hostKeyVerificationStrategy: ACCEPT_NEW
        iamInstanceProfile: ${/jenkins/config/instanceprofile}
        idleTerminationMinutes: "30"
        labelString: "windows-b3c8994f1"
        maxTotalUses: 1
        metadataEndpointEnabled: true
        metadataHopsLimit: 1
        metadataTokensRequired: true
        minimumNumberOfInstances: 0
        minimumNumberOfSpareInstances: 0
        mode: EXCLUSIVE
        monitoring: false
        numExecutors: 1
        remoteAdmin: ${/jenkins/config/buildnode/username}
        remoteFS: "c:/ly"
        securityGroups: ${/jenkins/config/security-group}
        stopOnTerminate: false
        subnetId: "subnet-0a67f5cb6cc79e89f"
        t2Unlimited: false
        tags:
        - name: "Name"
          value: "WIN2019_INC_3"
        tenancy: Default
        tmpDir: "$(cygpath -w /cygdrive/c/ly)"
        type: C59xlarge
        useEphemeralDevices: false
        zone: "us-west-2a"
      - ami: "ami-0c169196f4a990b3e"
        amiType:
          unixData:
            sshPort: "22"
        associatePublicIp: false
        connectBySSHProcess: false
        connectionStrategy: PRIVATE_IP
        deleteRootOnTermination: false
        description: "WIN2022_INC_1_TEST"
        ebsEncryptRootVolume: DEFAULT
        ebsOptimized: true
        hostKeyVerificationStrategy: ACCEPT_NEW
        iamInstanceProfile: ${/jenkins/config/instanceprofile}
        idleTerminationMinutes: "30"
        labelString: "windows-b3c8994f1-debug windows-b3c8994f1-test windows-a4a28adb2-test windows-2022 windows-latest"
        maxTotalUses: 1
        metadataEndpointEnabled: true
        metadataHopsLimit: 1
        metadataTokensRequired: true
        minimumNumberOfInstances: 0
        minimumNumberOfSpareInstances: 0
        mode: EXCLUSIVE
        monitoring: false
        numExecutors: 1
        remoteAdmin: ${/jenkins/config/buildnode/username}
        remoteFS: "c:/ly"
        securityGroups: ${/jenkins/config/security-group}
        stopOnTerminate: false
        subnetId: "subnet-0a67f5cb6cc79e89f"
        t2Unlimited: false
        tags:
        - name: "Name"
          value: "Beta_WIN2022_INC_1"
        tenancy: Default
        tmpDir: "C:\\ly"
        type: C6a4xlarge
        useEphemeralDevices: false
        userData: "git config --global --add safe.directory '*'"
      - ami: "ami-00cd01aeb5a4d5b9d"
        amiType:
          unixData:
            sshPort: "22"
        associatePublicIp: false
        connectBySSHProcess: false
        connectionStrategy: PRIVATE_IP
        deleteRootOnTermination: false
        description: "Beta_UBUNTU22_BLD_1"
        ebsEncryptRootVolume: DEFAULT
        ebsOptimized: true
        hostKeyVerificationStrategy: ACCEPT_NEW
        iamInstanceProfile: ${/jenkins/config/instanceprofile}
        idleTerminationMinutes: "300"
        labelString: "linux-7058deb8-test linux-ubuntu-22 ubuntu-22-packaging"
        maxTotalUses: 1
        metadataEndpointEnabled: true
        metadataHopsLimit: 1
        metadataTokensRequired: true
        minimumNumberOfInstances: 0
        minimumNumberOfSpareInstances: 0
        mode: EXCLUSIVE
        monitoring: false
        nodeProperties:
        - envVars:
            env:
            - key: "DISPLAY"
              value: ":0"
        numExecutors: 1
        remoteAdmin: ${/jenkins/config/buildnode/username}
        remoteFS: "/home/lybuilder/ly"
        securityGroups: ${/jenkins/config/security-group}
        stopOnTerminate: false
        subnetId: ${/jenkins/config/subnet-id}
        t2Unlimited: false
        tags:
        - name: "Name"
          value: "Beta_UBUNTU22_BLD_1"
        tenancy: Default
        type: C54xlarge
        useEphemeralDevices: false
        userData: "#!/bin/bash\nsed -i /etc/hosts -e \"s/^127.0.0.1 localhost$/127.0.0.1\
          \ localhost $(hostname)/\" \necho 'export ENV_3RDPARTY_PATH=/home/lybuilder/ly/workspace/3rdParty'\
          \ >> /etc/profile.d/jenkins_config.sh\necho 'export TMPDIR=/tmp' >> /etc/profile.d/jenkins_config.sh\n\
          sudo apt-get remove -y ec2-instance-connect \nsudo systemctl start filebeat\n\
          sudo ulimit -c unlimited\nsystemctl restart apport\n\nsudo dd if=/dev/zero\
          \ of=/swapfile bs=1M count=8196 &&\nsudo chmod 600 /swapfile &&\nsudo mkswap\
          \ /swapfile &&\nsudo swapon /swapfile\n\nwget https://s3.amazonaws.com/amazoncloudwatch-agent/ubuntu/amd64/latest/amazon-cloudwatch-agent.deb\
          \ -O /tmp/amazon-cloudwatch-agent.deb\nsudo dpkg -i /tmp/amazon-cloudwatch-agent.deb\n\
          aws s3 cp s3://o3de-node-setup/linux/cloudwatch/CloudWatchAgentConfig.json\
          \ /opt/aws/amazon-cloudwatch-agent/CloudWatchAgentConfig.json\nsudo /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl\
          \ -a fetch-config -m ec2 -s -c file:/opt/aws/amazon-cloudwatch-agent/CloudWatchAgentConfig.json\n\
          \nsudo systemctl stop systemd-timesyncd\nsudo systemctl disable systemd-timesyncd\n\
          sudo apt install -y chrony libzstd-dev\n\nsed -i '1s/^/server 169.254.169.123\
          \ prefer iburst minpoll 4 maxpoll 4\\n/' /etc/chrony/chrony.conf\n/etc/init.d/chrony\
          \ restart"
        zone: "us-west-2a"
      - ami: "ami-000a8c3f0d8d4e26b"
        amiType:
          unixData:
            sshPort: "22"
        associatePublicIp: false
        connectBySSHProcess: false
        connectionStrategy: PRIVATE_IP
        deleteRootOnTermination: false
        description: "WIN2019_INC_4"
        ebsEncryptRootVolume: DEFAULT
        ebsOptimized: true
        hostKeyVerificationStrategy: ACCEPT_NEW
        iamInstanceProfile: ${/jenkins/config/instanceprofile}
        idleTerminationMinutes: "30"
        labelString: "windows-latest windows-8fe4037c"
        launchTimeoutStr: "600"
        maxTotalUses: 1
        metadataEndpointEnabled: true
        metadataHopsLimit: 1
        metadataTokensRequired: true
        minimumNumberOfInstances: 0
        minimumNumberOfSpareInstances: 0
        mode: EXCLUSIVE
        monitoring: false
        numExecutors: 1
        remoteAdmin: ${/jenkins/config/buildnode/username}
        remoteFS: "c:/ly"
        securityGroups: ${/jenkins/config/security-group}
        stopOnTerminate: false
        subnetId: ${/jenkins/config/subnet-id}
        t2Unlimited: false
        tags:
        - name: "Name"
          value: "WIN2019_INC_4"
        tenancy: Default
        tmpDir: "$(cygpath -w /cygdrive/c/ly)"
        type: C6a4xlarge
        useEphemeralDevices: false
        userData: "<powershell>\n[Environment]::SetEnvironmentVariable(\"JAVA_HOME\"\
          , $null ,\"Machine\") \n</powershell>"
        zone: "us-west-2a"
      - ami: "ami-0966abb2fd17f5ead"
        amiType:
          unixData:
            sshPort: "22"
        associatePublicIp: false
        connectBySSHProcess: false
        connectionStrategy: PRIVATE_IP
        deleteRootOnTermination: false
        description: "Beta_UBUNTU22_ARM_BLD_1"
        ebsEncryptRootVolume: DEFAULT
        ebsOptimized: true
        hostKeyVerificationStrategy: ACCEPT_NEW
        iamInstanceProfile: ${/jenkins/config/instanceprofile}
        idleTerminationMinutes: "300"
        labelString: "linux-ubuntu-22-arm"
        maxTotalUses: 1
        metadataEndpointEnabled: true
        metadataHopsLimit: 1
        metadataTokensRequired: true
        minimumNumberOfInstances: 0
        minimumNumberOfSpareInstances: 0
        mode: EXCLUSIVE
        monitoring: false
        nodeProperties:
        - envVars:
            env:
            - key: "DISPLAY"
              value: ":0"
        numExecutors: 1
        remoteAdmin: ${/jenkins/config/buildnode/username}
        remoteFS: "/home/lybuilder/ly"
        securityGroups: ${/jenkins/config/security-group}
        stopOnTerminate: false
        subnetId: ${/jenkins/config/subnet-id}
        t2Unlimited: false
        tags:
        - name: "Name"
          value: "Beta_UBUNTU22_ARM_BLD_1"
        tenancy: Default
        type: C7g4xlarge
        useEphemeralDevices: false
        userData: "#!/bin/bash\nsed -i /etc/hosts -e \"s/^127.0.0.1 localhost$/127.0.0.1\
          \ localhost $(hostname)/\" \necho 'export ENV_3RDPARTY_PATH=/home/lybuilder/ly/workspace/3rdParty'\
          \ >> /etc/profile.d/jenkins_config.sh\necho 'export TMPDIR=/tmp' >> /etc/profile.d/jenkins_config.sh\n\
          sudo apt-get remove -y ec2-instance-connect \nsudo apt-get install -y libzstd-dev\n\
          sudo systemctl start filebeat\nsudo ulimit -c unlimited\nsystemctl restart\
          \ apport\n\nsudo dd if=/dev/zero of=/swapfile bs=1M count=8196 &&\nsudo\
          \ chmod 600 /swapfile &&\nsudo mkswap /swapfile &&\nsudo swapon /swapfile"
        zone: "us-west-2a"
      useInstanceProfileForCredentials: false
  - amazonEC2:
      cloudName: "mac-us-west-2"
      instanceCapStr: "20"
      noDelayProvisioning: true
      region: "us-west-2"
      sshKeysCredentialsId: "jenkins-build-node"
      templates:
      - ami: "ami-03af6db1aea63ae3d"
        amiType:
          unixData:
            sshPort: "22"
        associatePublicIp: false
        connectBySSHProcess: false
        connectionStrategy: PRIVATE_IP
        deleteRootOnTermination: false
        description: "EC2_Mac_BIGSUR_BLD_1"
        ebsEncryptRootVolume: DEFAULT
        ebsOptimized: true
        hostKeyVerificationStrategy: ACCEPT_NEW
        iamInstanceProfile: ${/jenkins/config/instanceprofile}
        idleTerminationMinutes: "360"
        initScript: |-
          sudo launchctl setenv ES_HOSTS "https://search-mars-sandbox-cvwlujlhbvt5y7epd4jgon4pqq.eu-west-2.es.amazonaws.com:443"
          sudo launchctl unload /Library/LaunchDaemons/filebeat.plist
          sudo launchctl load /Library/LaunchDaemons/filebeat.plist
        instanceCapStr: "10"
        labelString: "mac-bigsur-2fc3a22"
        launchTimeoutStr: "10800"
        maxTotalUses: -1
        metadataEndpointEnabled: true
        metadataHopsLimit: 1
        metadataTokensRequired: true
        minimumNumberOfInstances: 4
        minimumNumberOfSpareInstances: 8
        mode: EXCLUSIVE
        monitoring: false
        numExecutors: 1
        remoteAdmin: ${/jenkins/config/buildnode/username}
        remoteFS: "/Users/lybuilder/jenkins"
        securityGroups: ${/jenkins/config/security-group}
        stopOnTerminate: true
        subnetId: ${/jenkins/config/subnet-id}
        t2Unlimited: false
        tags:
        - name: "Name"
          value: "BIGSUR_BLD_1"
        tenancy: Host
        type: Mac1Metal
        useEphemeralDevices: false
        userData: |-
          #!/bin/bash
          python3 -m pip install PyGithub
        zone: "us-west-2a"
  - amazonEC2:
      cloudName: "gpu-cpu-tests-us-west-2"
      region: "us-west-2"
      sshKeysCredentialsId: "jenkins-build-node"
      templates:
      - ami: "ami-08d5a7dde471291ad"
        amiType:
          unixData:
            sshPort: "22"
        associatePublicIp: false
        connectBySSHProcess: false
        connectionStrategy: PRIVATE_IP
        deleteRootOnTermination: false
        description: "WIN2019_GPU_2_Test"
        ebsEncryptRootVolume: DEFAULT
        ebsOptimized: true
        hostKeyVerificationStrategy: ACCEPT_NEW
        iamInstanceProfile: ${/jenkins/config/instanceprofile}
        idleTerminationMinutes: "30"
        labelString: "windows-gpu-test"
        launchTimeoutStr: "600"
        maxTotalUses: 1
        metadataEndpointEnabled: true
        metadataHopsLimit: 1
        metadataTokensRequired: true
        minimumNumberOfInstances: 0
        minimumNumberOfSpareInstances: 0
        mode: EXCLUSIVE
        monitoring: false
        numExecutors: 1
        remoteAdmin: ${/jenkins/config/buildnode/username}
        remoteFS: "c:/ly"
        securityGroups: ${/jenkins/config/security-group}
        spotConfig:
          spotMaxBidPrice: "3.64"
          useBidPrice: true
        stopOnTerminate: false
        subnetId: "subnet-0a67f5cb6cc79e89f"
        t2Unlimited: false
        tags:
        - name: "Name"
          value: "WIN2019_GPU_2"
        tenancy: Default
        tmpDir: "$(cygpath -w /cygdrive/c/ly)"
        type: G4dn4xlarge
        useEphemeralDevices: false
        zone: "us-west-2a"
      useInstanceProfileForCredentials: false
  - amazonEC2:
      cloudName: "Metrics"
      noDelayProvisioning: true
      region: "us-west-2"
      sshKeysCredentialsId: "jenkins-build-node"
      templates:
      - ami: "ami-07e0caede54ba0c81"
        amiType:
          unixData:
            sshPort: "22"
        associatePublicIp: false
        connectBySSHProcess: false
        connectionStrategy: PRIVATE_IP
        deleteRootOnTermination: false
        description: "MARS_PUBLISH_1"
        ebsEncryptRootVolume: DEFAULT
        ebsOptimized: true
        hostKeyVerificationStrategy: ACCEPT_NEW
        iamInstanceProfile: ${/jenkins/config/instanceprofile}
        idleTerminationMinutes: "30"
        instanceCapStr: "2"
        labelString: "metrics"
        launchTimeoutStr: "300"
        maxTotalUses: -1
        metadataEndpointEnabled: true
        metadataHopsLimit: 1
        metadataTokensRequired: true
        minimumNumberOfInstances: 0
        minimumNumberOfSpareInstances: 0
        mode: EXCLUSIVE
        monitoring: false
        numExecutors: 1
        remoteAdmin: ${/jenkins/config/buildnode/username}
        remoteFS: "/home/lybuilder/ly"
        securityGroups: ${/jenkins/config/security-group}
        stopOnTerminate: false
        subnetId: "subnet-095d78fbeba94a487"
        t2Unlimited: false
        tags:
        - name: "Name"
          value: "MARS_PUBLISH_1"
        tenancy: Default
        type: M5Large
        useEphemeralDevices: false
        userData: |-
          #!/bin/bash
          sudo systemctl start filebeat-prod filebeat-sandbox
          filebeat test config
          filebeat test output
        zone: "us-west-2b"
      useInstanceProfileForCredentials: false
  - amazonEC2:
      cloudName: "Packaging"
      region: "us-west-2"
      sshKeysCredentialsId: "jenkins-build-node"
      templates:
      - ami: "ami-021edaa5d4d476bdf"
        amiType:
          unixData:
            sshPort: "22"
        associatePublicIp: false
        connectBySSHProcess: false
        connectionStrategy: PRIVATE_IP
        deleteRootOnTermination: false
        description: "UBUNTU20_BLD_2_Packaging_Test"
        ebsEncryptRootVolume: DEFAULT
        ebsOptimized: true
        hostKeyVerificationStrategy: ACCEPT_NEW
        iamInstanceProfile: ${/jenkins/config/instanceprofile}
        idleTerminationMinutes: "300"
        maxTotalUses: -1
        metadataEndpointEnabled: true
        metadataHopsLimit: 1
        metadataTokensRequired: true
        minimumNumberOfInstances: 0
        minimumNumberOfSpareInstances: 0
        mode: NORMAL
        monitoring: false
        numExecutors: 1
        remoteAdmin: ${/jenkins/config/buildnode/username}
        remoteFS: "/home/lybuilder/ly"
        securityGroups: ${/jenkins/config/security-group}
        stopOnTerminate: false
        subnetId: ${/jenkins/config/subnet-id}
        t2Unlimited: false
        tenancy: Default
        type: C5a4xlarge
        useEphemeralDevices: false
        userData: "#!/bin/bash\nsed -i /etc/hosts -e \"s/^127.0.0.1 localhost$/127.0.0.1\
          \ localhost $(hostname)/\" \necho 'export ENV_3RDPARTY_PATH=/home/lybuilder/ly/workspace/3rdParty'\
          \ >> /etc/profile.d/jenkins_config.sh\necho 'export TMPDIR=/tmp' >> /etc/profile.d/jenkins_config.sh\n\
          echo 'export GPG_TTY=$(tty)' >> /etc/profile.d/jenkins_config.sh\nsudo systemctl\
          \ start filebeat\n\nsudo rm -v /etc/apt/apt.conf.d/70debconf\nsudo apt-get\
          \ install -y dpkg-sig keychain\n\nsu - lybuilder -c ` \\\n\nexport GNUPGHOME=/home/lybuilder/.gnupg;\n\
          pass=$(aws secretsmanager get-secret-value --secret-id jenkins-github/gpg/o3de-release-private.key\
          \ --query SecretString --output text);\naws s3 cp s3://ly-signing-keys/linux/o3de-releases-signing.key\
          \ - | gpg --pinentry-mode loopback --passphrase $pass --import;\nchown -R\
          \ lybuilder $GNUPGHOME;\nfpr=$(gpg --no-tty --list-keys --with-colons  |\
          \ awk -F: '/fpr:/ {print $10; exit}');\necho -e '5\\ny\\n' | gpg --no-tty\
          \ --command-fd 0 --expert --edit-key $fpr trust;\necho 'allow-preset-passphrase'\
          \ >> $GNUPGHOME/gpg-agent.conf;\necho 'max-cache-ttl 14400' >> $GNUPGHOME/gpg-agent.conf;\n\
          echo 'pinentry-program /usr/bin/pinentry-curses' >> $GNUPGHOME/gpg-agent.conf;\n\
          gpg-connect-agent reloadagent /bye;\nchown -R lybuilder $GNUPGHOME;\necho\
          \ -e \"$pass\\n\" | keychain --eval --agents gpg $fpr;\n`"
        zone: "us-west-2a"
      - ami: "ami-0b6a8649a4a28adb2"
        amiType:
          unixData:
            sshPort: "22"
        associatePublicIp: false
        connectBySSHProcess: false
        connectionStrategy: PRIVATE_IP
        deleteRootOnTermination: false
        description: "WIN2019_INC_4_Installer_Test"
        ebsEncryptRootVolume: DEFAULT
        ebsOptimized: true
        hostKeyVerificationStrategy: ACCEPT_NEW
        iamInstanceProfile: ${/jenkins/config/instanceprofile}
        idleTerminationMinutes: "30"
        labelString: "windows-installer-test windows-packaging"
        launchTimeoutStr: "600"
        maxTotalUses: -1
        metadataEndpointEnabled: true
        metadataHopsLimit: 1
        metadataTokensRequired: true
        minimumNumberOfInstances: 0
        minimumNumberOfSpareInstances: 0
        mode: EXCLUSIVE
        monitoring: false
        numExecutors: 1
        remoteAdmin: ${/jenkins/config/buildnode/username}
        remoteFS: "c:/ly"
        securityGroups: ${/jenkins/config/security-group}
        stopOnTerminate: false
        subnetId: "subnet-0a67f5cb6cc79e89f"
        t2Unlimited: false
        tags:
        - name: "Name"
          value: "WIN2019_INC_4_Installer_Test"
        tenancy: Default
        tmpDir: "$(cygpath -w /cygdrive/c/ly)"
        type: C59xlarge
        useEphemeralDevices: false
        zone: "us-west-2a"
      useInstanceProfileForCredentials: false
  - amazonEC2:
      cloudName: "Management"
      region: "us-west-2"
      sshKeysCredentialsId: "jenkins-build-node"
      templates:
      - ami: "ami-036b0c111e785e5b3"
        amiType:
          unixData:
            sshPort: "22"
        associatePublicIp: false
        connectBySSHProcess: false
        connectionStrategy: PRIVATE_IP
        deleteRootOnTermination: false
        description: "ubuntu-command-host"
        ebsEncryptRootVolume: DEFAULT
        ebsOptimized: true
        hostKeyVerificationStrategy: ACCEPT_NEW
        iamInstanceProfile: "arn:aws:iam::288697475520:instance-profile/jenkins-node-cfn-deploy"
        idleTerminationMinutes: "30"
        instanceCapStr: "1"
        labelString: "ubuntu-command"
        launchTimeoutStr: "300"
        maxTotalUses: -1
        metadataEndpointEnabled: true
        metadataHopsLimit: 1
        metadataTokensRequired: true
        minimumNumberOfInstances: 0
        minimumNumberOfSpareInstances: 0
        mode: EXCLUSIVE
        monitoring: false
        numExecutors: 1
        remoteAdmin: ${/jenkins/config/buildnode/username}
        remoteFS: "/home/lybuilder/ly"
        securityGroups: ${/jenkins/config/security-group}
        stopOnTerminate: false
        subnetId: "subnet-095d78fbeba94a487"
        t2Unlimited: false
        tags:
        - name: "Name"
          value: "ubuntu-command"
        tenancy: Default
        type: C5aLarge
        useEphemeralDevices: false
        userData: "#!/bin/bash\nsed -i /etc/hosts -e \"s/^127.0.0.1 localhost$/127.0.0.1\
          \ localhost $(hostname)/\" \necho 'export ENV_3RDPARTY_PATH=/home/lybuilder/ly/workspace/3rdParty'\
          \ >> /etc/profile.d/jenkins_config.sh\necho 'export TMPDIR=/tmp' >> /etc/profile.d/jenkins_config.sh\n\
          sudo apt-get install -y apt-transport-https ca-certificates curl software-properties-common\
          \ unzip jq \nsudo apt-get install -y python3 python3-pip python-is-python3\n\
          curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add\
          \ \nsudo add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu\
          \ focal stable\"\nsudo apt update\nsudo apt install -y docker-ce\nsudo service\
          \ docker start\nsudo usermod -a -G docker lybuilder"
        zone: "us-west-2a"
      useInstanceProfileForCredentials: false
